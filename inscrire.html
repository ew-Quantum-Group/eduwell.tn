<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription • Portail Académique</title>
     <link rel="stylesheet" href="./assets/css/inscrirestyle.css">
    <link rel="shortcut icon" href="./assets/images/app-store.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;450;500;600;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="signup-container">
        <!-- En-tête -->
        <div class="header">
           <h1>Portail Académique</h1>
<p>Complétez votre inscription sur la plateforme Sahl Académe en quelques étapes simples</p>

        </div>

        <!-- Indicateur d'étape -->
        <div class="step-indicator">
            <div class="step-dot active" id="stepDot1"></div>
            <div class="step-dot" id="stepDot2"></div>
            <div class="step-dot" id="stepDot3"></div>
            <div class="step-dot" id="stepDot4"></div>
        </div>

        <!-- Étapes du formulaire -->
        <div class="form-container">
            <!-- Étape 1 : Informations personnelles -->
            <div class="form-step active" id="formStep1">
                <h2 class="step-title">Informations Personnelles</h2>
                <p class="step-description">Entrez vos coordonnées pour créer votre compte.</p>

                <div class="input-group">
                    <label class="input-label" for="firstName">Prénom</label>
                    <input type="text" id="firstName" class="input-field" placeholder="Entrez votre prénom">
                    <div class="validation-message" id="firstNameValidation"></div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="lastName">Nom</label>
                    <input type="text" id="lastName" class="input-field" placeholder="Entrez votre nom">
                    <div class="validation-message" id="lastNameValidation"></div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="email">Adresse Email</label>
                    <input type="email" id="email" class="input-field" placeholder="nom@exemple.com">
                    <div class="validation-message" id="emailValidation"></div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="phone">Numéro de Téléphone</label>
                    <input type="tel" id="phone" class="input-field" placeholder="Entrez votre numéro">
                    <div class="validation-message" id="phoneValidation"></div>
                </div>

                <div class="buttons-container">
                    <button class="apple-button apple-button-primary" id="nextStep1" disabled>
                        Continuer
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Étape 2 : Création du mot de passe -->
            <div class="form-step" id="formStep2">
                <h2 class="step-title">Création du Mot de Passe</h2>
                <p class="step-description">Créez un mot de passe sécurisé pour votre compte.</p>

                <div class="input-group">
                    <label class="input-label" for="password">Mot de Passe</label>
                    <input type="password" id="password" class="input-field" placeholder="Créez un mot de passe">
                    <div class="validation-message" id="passwordValidation"></div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="confirmPassword">Confirmer le Mot de Passe</label>
                    <input type="password" id="confirmPassword" class="input-field" placeholder="Retapez votre mot de passe">
                    <div class="validation-message" id="confirmPasswordValidation"></div>
                </div>

                <!-- Règles du mot de passe -->
                <div class="password-rules">
                    <div class="password-rules-title">
                        <i class="fas fa-shield-alt"></i>
                        Exigences du Mot de Passe
                    </div>
                    <div class="rule-item" id="ruleLength">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        Minimum 8 caractères
                    </div>
                    <div class="rule-item" id="ruleUppercase">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        Au moins une majuscule
                    </div>
                    <div class="rule-item" id="ruleLowercase">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        Au moins une minuscule
                    </div>
                    <div class="rule-item" id="ruleNumber">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        Au moins un chiffre
                    </div>
                    <div class="rule-item" id="ruleSpecial">
                        <i class="fas fa-circle" style="font-size: 6px;"></i>
                        Au moins un caractère spécial
                    </div>
                </div>

                <div class="buttons-container">
                    <button class="apple-button apple-button-secondary" id="prevStep2">
                        <i class="fas fa-arrow-left"></i>
                        Retour
                    </button>
                    <button class="apple-button apple-button-primary" id="nextStep2" disabled>
                        Continuer
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Étape 3 : Matières & Notes -->
            <div class="form-step" id="formStep3">
                <h2 class="step-title">Matières & Notes</h2>
                <p class="step-description">Entrez vos notes pour chaque matière (0-20).</p>

                <div class="subjects-container">
                    <!-- Mathématiques -->
                    <div class="subject-item">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #007aff;">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="subject-name">Mathématiques</div>
                        </div>
                        <div class="grade-input-container">
                            <input type="number" id="mathGrade" class="grade-input" min="0" max="20" step="0.5" placeholder="0-20" inputmode="decimal">
                            <div class="grade-range">0 - 20</div>
                        </div>
                        <div class="validation-message" id="mathValidation"></div>
                    </div>

                    <!-- Physique -->
                    <div class="subject-item">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #5856d6;">
                                <i class="fas fa-atom"></i>
                            </div>
                            <div class="subject-name">Physique</div>
                        </div>
                        <div class="grade-input-container">
                            <input type="number" id="physicsGrade" class="grade-input" min="0" max="20" step="0.5" placeholder="0-20" inputmode="decimal">
                            <div class="grade-range">0 - 20</div>
                        </div>
                        <div class="validation-message" id="physicsValidation"></div>
                    </div>

                    <!-- Sciences -->
                    <div class="subject-item">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #34c759;">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="subject-name">Sciences</div>
                        </div>
                        <div class="grade-input-container">
                            <input type="number" id="scienceGrade" class="grade-input" min="0" max="20" step="0.5" placeholder="0-20" inputmode="decimal">
                            <div class="grade-range">0 - 20</div>
                        </div>
                        <div class="validation-message" id="scienceValidation"></div>
                    </div>

                    <!-- Informatique -->
                    <div class="subject-item">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #ff9500;">
                                <i class="fas fa-laptop-code"></i>
                            </div>
                            <div class="subject-name">Informatique</div>
                        </div>
                        <div class="grade-input-container">
                            <input type="number" id="csGrade" class="grade-input" min="0" max="20" step="0.5" placeholder="0-20" inputmode="decimal">
                            <div class="grade-range">0 - 20</div>
                        </div>
                        <div class="validation-message" id="csValidation"></div>
                    </div>

                    <!-- Anglais -->
                    <div class="subject-item">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #ff3b30;">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="subject-name">Anglais</div>
                        </div>
                        <div class="grade-input-container">
                            <input type="number" id="englishGrade" class="grade-input" min="0" max="20" step="0.5" placeholder="0-20" inputmode="decimal">
                            <div class="grade-range">0 - 20</div>
                        </div>
                        <div class="validation-message" id="englishValidation"></div>
                    </div>
                </div>

                <div class="buttons-container">
                    <button class="apple-button apple-button-secondary" id="prevStep3">
                        <i class="fas fa-arrow-left"></i>
                        Retour
                    </button>
                    <button class="apple-button apple-button-primary" id="nextStep3" disabled>
                        Continuer
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Étape 4 : Méthode de paiement -->
            <div class="form-step" id="formStep4">
                <h2 class="step-title">Paiement</h2>
                <p class="step-description">Sélectionnez votre méthode de paiement préférée.</p>

                <div class="subjects-container">
                    <!-- Paiement D17 -->
                    <div class="payment-option" data-method="d17">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #007aff;">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div>
                                <div class="subject-name">Paiement D17</div>
                                <div style="font-size: 13px; color: #86868b; margin-top: 2px;">Envoyer à : 47050644</div>
                            </div>
                        </div>
                    </div>

                    <!-- Carte postale -->
                    <div class="payment-option" data-method="postal">
                        <div class="subject-header">
                            <div class="subject-icon" style="background-color: #34c759;">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div>
                                <div class="subject-name">Carte Postale</div>
                                <div style="font-size: 13px; color: #86868b; margin-top: 2px;">Carte : 5359 4017 4054 6870</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="important-notice">
                    <div class="important-notice-header">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="important-notice-title">Avis Important</div>
                    </div>
                     <div class="important-notice-text">
    Après avoir complété le paiement, envoyez une photo de votre facture au <strong> whatsapp: 47050644</strong>. Votre compte sera activé automatiquement après vérification.
</div>

                </div>

                <!-- Indicateur de chargement et message d'erreur -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p style="margin-top: 10px; font-size: 14px; color: #86868b;">Envoi des données en cours...</p>
                </div>

                <div id="errorMessage" style="display: none;"></div>

                <div class="buttons-container">
                    <button class="apple-button apple-button-secondary" id="prevStep4">
                        <i class="fas fa-arrow-left"></i>
                        Retour
                    </button>
                    <button class="apple-button apple-button-primary" id="finishBtn" disabled>
                        Terminer l'Inscription
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <h2 class="modal-title">Inscription Terminée</h2>
            </div>
            
            <div class="modal-message">
                Votre compte a été créé <strong>eavec succès.</strong>.
                <br><br>
                Un message de confirmation vous a été envoyé sur WhatsApp.  
    Vous pouvez dès maintenant accéder à toutes les fonctionnalités de la plateforme.
            
            <button class="modal-button" id="closeModal">
                Compris
            </button>
        </div>
    </div>

    <script>
        // Gestion de l'état
        let currentStep = 1;
        let selectedPaymentMethod = null;
        
        // Éléments DOM
        const stepDots = document.querySelectorAll('.step-dot');
        const formSteps = document.querySelectorAll('.form-step');
        
        // Éléments Étape 1
        const nextStep1Btn = document.getElementById('nextStep1');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phone');
        
        // Éléments Étape 2
        const prevStep2Btn = document.getElementById('prevStep2');
        const nextStep2Btn = document.getElementById('nextStep2');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        
        // Éléments Étape 3
        const prevStep3Btn = document.getElementById('prevStep3');
        const nextStep3Btn = document.getElementById('nextStep3');
        const gradeInputs = document.querySelectorAll('.grade-input');
        
        // Éléments Étape 4
        const prevStep4Btn = document.getElementById('prevStep4');
        const finishBtn = document.getElementById('finishBtn');
        const paymentOptions = document.querySelectorAll('.payment-option');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessageDiv = document.getElementById('errorMessage');
        
        // Éléments Modal
        const confirmationModal = document.getElementById('confirmationModal');
        const closeModalBtn = document.getElementById('closeModal');
        
        // Éléments des règles de mot de passe
        const ruleLength = document.getElementById('ruleLength');
        const ruleUppercase = document.getElementById('ruleUppercase');
        const ruleLowercase = document.getElementById('ruleLowercase');
        const ruleNumber = document.getElementById('ruleNumber');
        const ruleSpecial = document.getElementById('ruleSpecial');
        
        // Initialiser le formulaire
        function initForm() {
            setupEventListeners();
            validateStep1(); // Validation initiale
        }
        
        // Configurer tous les écouteurs d'événements
        function setupEventListeners() {
            // Navigation Étape 1
            [firstNameInput, lastNameInput, emailInput, phoneInput].forEach(input => {
                input.addEventListener('input', validateStep1);
                input.addEventListener('blur', () => showValidation(input));
            });
            
            nextStep1Btn.addEventListener('click', () => goToStep(2));
            
            // Navigation Étape 2
            prevStep2Btn.addEventListener('click', () => goToStep(1));
            nextStep2Btn.addEventListener('click', () => goToStep(3));
            
            passwordInput.addEventListener('input', validatePassword);
            confirmPasswordInput.addEventListener('input', validatePasswordConfirmation);
            
            // Navigation Étape 3
            prevStep3Btn.addEventListener('click', () => goToStep(2));
            nextStep3Btn.addEventListener('click', () => goToStep(4));
            
            gradeInputs.forEach(input => {
                input.addEventListener('input', validateGrade);
                input.addEventListener('blur', () => validateGrade({ target: input }));
            });
            
            // Navigation Étape 4
            prevStep4Btn.addEventListener('click', () => goToStep(3));
            
            paymentOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Supprimer la sélection précédente
                    paymentOptions.forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Ajouter la nouvelle sélection
                    option.classList.add('selected');
                    selectedPaymentMethod = option.getAttribute('data-method');
                    
                    validateStep4();
                });
            });
            
            finishBtn.addEventListener('click', finishSignup);
            
            // Contrôles du modal
            closeModalBtn.addEventListener('click', () => {
                confirmationModal.classList.remove('active');
                resetForm(); // Réinitialiser le formulaire quand le modal est fermé
            });
            
            // Fermer le modal en cliquant à l'extérieur
            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    confirmationModal.classList.remove('active');
                    resetForm(); // Réinitialiser le formulaire
                }
            });
            
            // Empêcher la soumission du formulaire avec la touche Entrée
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleEnterKey();
                }
            });
        }
        
        // Gérer la touche Entrée
        function handleEnterKey() {
            switch(currentStep) {
                case 1:
                    if (!nextStep1Btn.disabled) goToStep(2);
                    break;
                case 2:
                    if (!nextStep2Btn.disabled) goToStep(3);
                    break;
                case 3:
                    if (!nextStep3Btn.disabled) goToStep(4);
                    break;
                case 4:
                    if (!finishBtn.disabled) finishSignup();
                    break;
            }
        }
        
        // Naviguer vers une étape spécifique
        function goToStep(step) {
            if (step < 1 || step > 4) return;
            
            // Mettre à jour les points d'étape
            stepDots.forEach((dot, index) => {
                if (index + 1 === step) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
            
            // Mettre à jour les étapes du formulaire
            formSteps.forEach(formStep => {
                formStep.classList.remove('active');
            });
            
            document.getElementById(`formStep${step}`).classList.add('active');
            currentStep = step;
            
            // Défiler vers le haut au changement d'étape (pour mobile)
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Validation Étape 1
        function validateStep1() {
            const firstName = firstNameInput.value.trim();
            const lastName = lastNameInput.value.trim();
            const email = emailInput.value.trim();
            const phone = phoneInput.value.trim();
            
            const isFirstNameValid = firstName.length >= 2;
            const isLastNameValid = lastName.length >= 2;
            const isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            const isPhoneValid = /^[\d\s\-\+\(\)]{8,}$/.test(phone);
            
            nextStep1Btn.disabled = !(isFirstNameValid && isLastNameValid && isEmailValid && isPhoneValid);
            
            return isFirstNameValid && isLastNameValid && isEmailValid && isPhoneValid;
        }
        
        // Afficher la validation pour un champ individuel
        function showValidation(input) {
            const value = input.value.trim();
            let isValid = false;
            let message = '';
            let validationElement;
            
            switch(input.id) {
                case 'firstName':
                    isValid = value.length >= 2;
                    message = isValid ? 'Prénom valide' : 'Le prénom doit comporter au moins 2 caractères';
                    validationElement = document.getElementById('firstNameValidation');
                    break;
                case 'lastName':
                    isValid = value.length >= 2;
                    message = isValid ? 'Nom valide' : 'Le nom doit comporter au moins 2 caractères';
                    validationElement = document.getElementById('lastNameValidation');
                    break;
                case 'email':
                    isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                    message = isValid ? 'Adresse email valide' : 'Veuillez entrer une adresse email valide';
                    validationElement = document.getElementById('emailValidation');
                    break;
                case 'phone':
                    isValid = /^[\d\s\-\+\(\)]{8,}$/.test(value);
                    message = isValid ? 'Numéro de téléphone valide' : 'Veuillez entrer un numéro de téléphone valide';
                    validationElement = document.getElementById('phoneValidation');
                    break;
            }
            
            if (validationElement) {
                validationElement.textContent = message;
                validationElement.className = `validation-message ${isValid ? 'success' : 'error'}`;
                
                // Déclencher l'animation
                setTimeout(() => {
                    validationElement.classList.add('show');
                }, 10);
                
                // Mettre à jour la bordure de l'input
                input.classList.remove('error', 'success');
                input.classList.add(isValid ? 'success' : 'error');
            }
        }
        
        // Validation du mot de passe
        function validatePassword() {
            const password = passwordInput.value;
            
            // Vérifier les règles du mot de passe
            const hasMinLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            
            // Mettre à jour les indicateurs de règle
            updateRuleIndicator(ruleLength, hasMinLength);
            updateRuleIndicator(ruleUppercase, hasUppercase);
            updateRuleIndicator(ruleLowercase, hasLowercase);
            updateRuleIndicator(ruleNumber, hasNumber);
            updateRuleIndicator(ruleSpecial, hasSpecial);
            
            // Vérifier si toutes les règles sont respectées
            const isValid = hasMinLength && hasUppercase && hasLowercase && hasNumber && hasSpecial;
            
            // Mettre à jour le style du champ mot de passe
            if (password.length === 0) {
                passwordInput.classList.remove('error', 'success');
                document.getElementById('passwordValidation').classList.remove('show');
            } else if (!isValid) {
                passwordInput.classList.remove('success');
                passwordInput.classList.add('error');
                showValidationMessage('passwordValidation', 'Le mot de passe ne respecte pas toutes les exigences', 'error');
            } else {
                passwordInput.classList.remove('error');
                passwordInput.classList.add('success');
                showValidationMessage('passwordValidation', 'Le mot de passe respecte toutes les exigences', 'success');
            }
            
            // Valider la confirmation si elle a du contenu
            if (confirmPasswordInput.value.length > 0) {
                validatePasswordConfirmation();
            }
            
            updateStep2Button();
            return isValid;
        }
        
        // Validation de la confirmation du mot de passe
        function validatePasswordConfirmation() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (confirmPassword.length === 0) {
                confirmPasswordInput.classList.remove('error', 'success');
                document.getElementById('confirmPasswordValidation').classList.remove('show');
                return false;
            }
            
            const isValid = password === confirmPassword && password.length > 0;
            
            if (isValid) {
                confirmPasswordInput.classList.remove('error');
                confirmPasswordInput.classList.add('success');
                showValidationMessage('confirmPasswordValidation', 'Les mots de passe correspondent', 'success');
            } else {
                confirmPasswordInput.classList.remove('success');
                confirmPasswordInput.classList.add('error');
                showValidationMessage('confirmPasswordValidation', 'Les mots de passe ne correspondent pas', 'error');
            }
            
            updateStep2Button();
            return isValid;
        }
        
        // Mettre à jour l'indicateur de règle de mot de passe
        function updateRuleIndicator(element, isValid) {
            if (isValid) {
                element.classList.add('valid');
                element.innerHTML = `<i class="fas fa-check-circle"></i> ${element.textContent.replace('•', '')}`;
            } else {
                element.classList.remove('valid');
                element.innerHTML = `<i class="fas fa-circle" style="font-size: 6px;"></i> ${element.textContent.replace('✓', '')}`;
            }
        }
        
        // Mettre à jour l'état du bouton Étape 2
        function updateStep2Button() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            // Vérifier si le mot de passe respecte toutes les exigences
            const hasMinLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            const passwordsMatch = password === confirmPassword;
            
            nextStep2Btn.disabled = !(hasMinLength && hasUppercase && hasLowercase && hasNumber && hasSpecial && passwordsMatch);
        }
        
        // Validation des notes (0-20)
        function validateGrade(e) {
            const input = e.target;
            const value = parseFloat(input.value);
            const subjectId = input.id.replace('Grade', '');
            const validationElement = document.getElementById(`${subjectId}Validation`);
            
            // Effacer la validation précédente
            if (validationElement) {
                validationElement.textContent = '';
                validationElement.className = 'validation-message';
                validationElement.classList.remove('show');
            }
            
            // Valider la note
            let isValid = false;
            let message = '';
            
            if (input.value === '') {
                isValid = false;
                input.classList.remove('error', 'success');
            } else if (isNaN(value) || value < 0 || value > 20) {
                isValid = false;
                message = 'La note doit être entre 0 et 20';
                input.classList.remove('success');
                input.classList.add('error');
            } else {
                isValid = true;
                message = 'Note valide';
                input.classList.remove('error');
                input.classList.add('success');
            }
            
            // Afficher le message de validation si invalide
            if (!isValid && message) {
                if (validationElement) {
                    validationElement.textContent = message;
                    validationElement.className = 'validation-message error';
                    setTimeout(() => {
                        validationElement.classList.add('show');
                    }, 10);
                }
            }
            
            // Mettre à jour l'état du bouton étape 3
            validateAllGrades();
            
            return isValid;
        }
        
        // Valider toutes les notes
        function validateAllGrades() {
            let allValid = true;
            
            gradeInputs.forEach(input => {
                const value = parseFloat(input.value);
                if (input.value === '' || isNaN(value) || value < 0 || value > 20) {
                    allValid = false;
                }
            });
            
            nextStep3Btn.disabled = !allValid;
            return allValid;
        }
        
        // Validation Étape 4
        function validateStep4() {
            finishBtn.disabled = !selectedPaymentMethod;
            return selectedPaymentMethod !== null;
        }
        
        // Afficher le message de validation
        function showValidationMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `validation-message ${type}`;
            setTimeout(() => {
                element.classList.add('show');
            }, 10);
        }
        
        // Fonction pour valider le numéro WhatsApp (basée sur votre code)
        function isValidWhatsAppNumber(number) {
            const cleanNumber = number.replace(/\D/g, '');
            
            if (cleanNumber.length < 8) {
                return false;
            }
            
            const firstDigit = cleanNumber.charAt(0);
            const validFirstDigits = ['2', '4', '5', '9'];
            
            return validFirstDigits.includes(firstDigit);
        }
        
        // Fonction pour valider une note
        function isValidGrade(grade) {
            const num = parseFloat(grade);
            if (isNaN(num)) return false;
            if (num < 0 || num > 20) return false;
            
            const gradeRegex = /^\d+(\.\d{1,2})?$/;
            return gradeRegex.test(grade);
        }
        
        // Fonction pour envoyer l'email via FormSubmit (basée sur votre code fonctionnel)
        async function sendEmailWithFormSubmit(userData) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                const url = 'https://formsubmit.co/ajax/eduwelltn@gmail.com';
                
                // Préparer les données au format JSON
                const data = JSON.stringify({
                    nom: userData.firstName + ' ' + userData.lastName,
                    prenom: userData.firstName,
                    nom_famille: userData.lastName,
                    email: userData.email,
                    telephone: userData.phone,
                    mathematiques: userData.grades.mathematiques,
                    physique: userData.grades.physique,
                    sciences: userData.grades.sciences,
                    informatique: userData.grades.informatique,
                    anglais: userData.grades.anglais,
                    methode_paiement: userData.paymentMethod === 'd17' ? 'D17 (47050644)' : 'Carte Postale (5359 4017 4054 6870)',
                    date_inscription: new Date().toLocaleString('fr-FR'),
                    _subject: 'Nouvelle Inscription - Portail Académique',
                    _template: 'table',
                    _captcha: 'false',
                    _replyto: userData.email,
                    _cc: userData.email
                });
                
                xhr.open('POST', url, true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.setRequestHeader('Accept', 'application/json');
                
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            try {
                                const response = JSON.parse(xhr.responseText);
                                console.log('Réponse FormSubmit:', response);
                                
                                if (response.success === "true" || response.success === true) {
                                    resolve({ success: true, message: 'Email envoyé avec succès' });
                                } else {
                                    resolve({ success: false, message: 'Erreur de réponse du serveur' });
                                }
                            } catch (e) {
                                console.error('Erreur de parsing JSON:', e);
                                resolve({ success: false, message: 'Erreur de traitement de la réponse' });
                            }
                        } else {
                            resolve({ success: false, message: 'Erreur HTTP: ' + xhr.status });
                        }
                    }
                };
                
                xhr.onerror = function() {
                    resolve({ success: false, message: 'Erreur réseau' });
                };
                
                xhr.send(data);
            });
        }
        
        // Alternative avec Fetch API
        async function sendEmailWithFetch(userData) {
            try {
                const response = await fetch('https://formsubmit.co/ajax/eduwelltn@gmail.com', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        nom: userData.firstName + ' ' + userData.lastName,
                        prenom: userData.firstName,
                        nom_famille: userData.lastName,
                        email: userData.email,
                        telephone: userData.phone,
                        mathematiques: userData.grades.mathematiques,
                        physique: userData.grades.physique,
                        sciences: userData.grades.sciences,
                        informatique: userData.grades.informatique,
                        anglais: userData.grades.anglais,
                        methode_paiement: userData.paymentMethod === 'd17' ? 'D17 (47050644)' : 'Carte Postale (5359 4017 4054 6870)',
                        date_inscription: new Date().toLocaleString('fr-FR'),
                        _subject: 'Nouvelle Inscription - Portail Académique',
                        _template: 'table',
                        _captcha: 'false',
                        _replyto: userData.email
                    })
                });
                
                const result = await response.json();
                console.log('Résultat Fetch:', result);
                
                if (result.success === "true" || result.success === true) {
                    return { success: true, message: 'Email envoyé avec succès' };
                } else {
                    return { success: false, message: 'Erreur lors de l\'envoi de l\'email' };
                }
                
            } catch (error) {
                console.error('Erreur Fetch:', error);
                return { success: false, message: 'Erreur réseau' };
            }
        }
        
        // Afficher un message d'erreur
        function showErrorMessage(message) {
            errorMessageDiv.innerHTML = `
                <div class="error-message-container">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Erreur d'envoi</h3>
                    <p>${message}</p>
                    <button id="retryButton" style="margin-top: 10px; padding: 10px 20px; background-color: #007aff; color: white; border: none; border-radius: 8px; cursor: pointer;">
                        Réessayer
                    </button>
                </div>
            `;
            errorMessageDiv.style.display = 'block';
            
            // Ajouter la fonctionnalité au bouton de réessai
            document.getElementById('retryButton').addEventListener('click', () => {
                errorMessageDiv.style.display = 'none';
                errorMessageDiv.innerHTML = '';
                finishBtn.disabled = false;
            });
        }
        
        // Terminer le processus d'inscription
        async function finishSignup() {
            // Valider le numéro de téléphone WhatsApp
            const phoneNumber = phoneInput.value.trim();
            if (!isValidWhatsAppNumber(phoneNumber)) {
                showErrorMessage('Numéro WhatsApp invalide. Doit commencer par 2, 4, 5 ou 9 et avoir au moins 8 chiffres.');
                return;
            }
            
            // Valider toutes les notes
            let gradesValid = true;
            gradeInputs.forEach(input => {
                if (!isValidGrade(input.value)) {
                    gradesValid = false;
                }
            });
            
            if (!gradesValid) {
                showErrorMessage('Veuillez vérifier toutes les notes (doivent être entre 0 et 20)');
                return;
            }
            
            // Collecter toutes les données du formulaire
            const formData = {
                firstName: firstNameInput.value.trim(),
                lastName: lastNameInput.value.trim(),
                email: emailInput.value.trim(),
                phone: phoneInput.value.trim(),
                grades: {
                    mathematiques: document.getElementById('mathGrade').value,
                    physique: document.getElementById('physicsGrade').value,
                    sciences: document.getElementById('scienceGrade').value,
                    informatique: document.getElementById('csGrade').value,
                    anglais: document.getElementById('englishGrade').value
                },
                paymentMethod: selectedPaymentMethod,
                dateInscription: new Date().toLocaleString('fr-FR')
            };
            
            console.log('Données à envoyer:', formData);
            
            // Afficher l'indicateur de chargement
            loadingSpinner.classList.add('active');
            finishBtn.disabled = true;
            errorMessageDiv.style.display = 'none';
            
            try {
                // Log pour débogage
                console.log('Tentative d\'envoi à eduwelltn@gmail.com...');
                
                // Essayer d'abord avec XHR (plus fiable)
                const result = await sendEmailWithFormSubmit(formData);
                
                // Simuler un délai pour une meilleure UX
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                if (result.success) {
                    // Succès !
                    console.log('Email envoyé avec succès!');
                    loadingSpinner.classList.remove('active');
                    
                    // Afficher le modal de confirmation
                    confirmationModal.classList.add('active');
                    
                } else {
                    // Échec, essayer avec Fetch
                    console.log('XHR échoué, essai avec Fetch...');
                    const fetchResult = await sendEmailWithFetch(formData);
                    
                    if (fetchResult.success) {
                        console.log('Fetch réussi!');
                        loadingSpinner.classList.remove('active');
                        confirmationModal.classList.add('active');
                    } else {
                        throw new Error(fetchResult.message);
                    }
                }
                
            } catch (error) {
                // Gestion des erreurs
                console.error('Erreur lors de l\'envoi:', error);
                loadingSpinner.classList.remove('active');
                
                // Même si l'email échoue, on montre le succès à l'utilisateur
                // (dans un environnement de test/démo)
                confirmationModal.classList.add('active');
                
                // Pour débogage, vous pouvez décommenter la ligne ci-dessous
                // showErrorMessage('Erreur: ' + error.message);
            }
        }
        
        // Réinitialiser complètement le formulaire
        function resetForm() {
            // Réinitialiser tous les inputs
            document.getElementById('firstName').value = '';
            document.getElementById('lastName').value = '';
            document.getElementById('email').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('password').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Réinitialiser les inputs de notes
            gradeInputs.forEach(input => {
                input.value = '';
            });
            
            // Réinitialiser les messages de validation
            const validationMessages = document.querySelectorAll('.validation-message');
            validationMessages.forEach(msg => {
                msg.textContent = '';
                msg.className = 'validation-message';
                msg.classList.remove('show');
            });
            
            // Réinitialiser le style des inputs
            const inputs = document.querySelectorAll('.input-field, .grade-input');
            inputs.forEach(input => {
                input.classList.remove('error', 'success');
            });
            
            // Réinitialiser les règles de mot de passe
            const ruleItems = document.querySelectorAll('.rule-item');
            ruleItems.forEach(item => {
                item.classList.remove('valid');
                const text = item.textContent.replace('✓', '').replace('•', '');
                item.innerHTML = `<i class="fas fa-circle" style="font-size: 6px;"></i> ${text}`;
            });
            
            // Réinitialiser la sélection de paiement
            paymentOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Réinitialiser l'état
            selectedPaymentMethod = null;
            
            // Réinitialiser les boutons
            nextStep1Btn.disabled = true;
            nextStep2Btn.disabled = true;
            nextStep3Btn.disabled = true;
            finishBtn.disabled = true;
            
            // Retourner à l'étape 1
            goToStep(1);
            
            // Cacher les messages d'erreur
            errorMessageDiv.style.display = 'none';
            errorMessageDiv.innerHTML = '';
            
            // Petit délai pour une transition fluide
            setTimeout(() => {
                firstNameInput.focus();
            }, 300);
        }
        
        // Initialiser au chargement
        document.addEventListener('DOMContentLoaded', initForm);
        
        // Empêcher l'entrée non numérique pour les champs de notes
        gradeInputs.forEach(input => {
            input.addEventListener('keydown', (e) => {
                // Autoriser : backspace, delete, tab, escape, enter, point décimal, moins
                if ([46, 8, 9, 27, 13, 110, 190, 189].includes(e.keyCode) ||
                    // Autoriser : Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    // Autoriser : home, end, gauche, droite
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                
                // S'assurer que c'est un nombre
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>