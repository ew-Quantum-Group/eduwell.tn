<!DOCTYPE html>
<html lang="fr">
<head>


    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FNTBT1VQN7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FNTBT1VQN7');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Portail d'Accès | Entrée Sécurisée</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./assets/css/stylesamrtebook.css">
    <link rel="shortcut icon" href="./assets/images/app-store.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;450;500;600;700&display=swap" rel="stylesheet">

</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage">
        <div class="landing-container">
            <div class="landing-logo">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="landing-title">Informations du compte</h1>
            <p class="landing-subtitle">Accédez aux informations associées à votre compte</p>
            <button class="enter-button" id="enterButton">
                <span>Voir mon compte</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Login Container -->
    <div class="container" id="loginContainer">
        <header class="header">
            <div class="icon-wrapper">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="title">Profil utilisateur</h1>
            <p class="subtitle">Entrez l’adresse e-mail associée à votre eBook ou le numéro de téléphone de votre Classroom</p>
        </header>

        <main>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password" class="form-label">E-mail ou numéro</label>
                    <div class="input-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            class="password-input" 
                            placeholder="Saisir le code d'accès" 
                            autocomplete="off"
                            required
                            maxlength="20"
                        >
                        <button type="button" class="toggle-password" id="togglePassword" aria-label="Afficher le mot de passe">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="submit-button" id="loginButton">
                    <span class="button-text">Continuer</span>
                    <div class="spinner"></div>
                </button>

                <div class="status-container">
                    <div class="status-message" id="statusMessage" role="alert" aria-live="polite"></div>
                </div>

                <div class="system-status">
                    <span class="status-indicator"></span>
                    <span id="systemStatusText">Système Prêt</span>
                </div>
            </form>
        </main>
    </div>

    <!-- Profile Container -->
    <div class="profile-container" id="profileContainer">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar"></div>
            <h2 class="profile-name" id="profileName"></h2>
            <span class="profile-code" id="profileCode"></span>
        </div>

        <div class="profile-details" id="profileDetails">
            <!-- Profile fields will be dynamically inserted here -->
        </div>

        <div class="profile-footer">
            <button class="logout-button" id="logoutButton">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="mainFooter">
        <a href="#" class="support-link" id="supportLink" aria-label="Support">
            <i class="fas fa-headset"></i>
            <span>Support</span>
        </a>
        <p class="copyright">© 2026 Eduwell Quantum Group</p>
    </footer>

    <script>
       
        // ==================== SESSION MANAGEMENT ====================
        const SessionManager = {
            currentSession: null,
            
            createSession(userData, code) {
                const token = this.generateToken();
                
                this.currentSession = {
                    token,
                    userData: { ...userData },
                    code,
                    createdAt: Date.now(),
                    expiresAt: Date.now() + (30 * 60 * 1000)
                };

                localStorage.setItem('securePortalSession', JSON.stringify({
                    token,
                    code,
                    timestamp: Date.now()
                }));

                return token;
            },

            validateSession() {
                // Check memory session first
                if (this.currentSession) {
                    if (Date.now() > this.currentSession.expiresAt) {
                        this.clearSession();
                        return false;
                    }
                    return true;
                }

                // Try to restore from localStorage
                try {
                    const stored = localStorage.getItem('securePortalSession');
                    if (!stored) return false;

                    const sessionData = JSON.parse(stored);
                    
                    // Check session timeout
                    if (Date.now() - sessionData.timestamp > 30 * 60 * 1000) {
                        this.clearSession();
                        return false;
                    }

                    // Check if user still exists and is active
                    const user = userDatabase[sessionData.code];
                    if (!user || !user.isActive) {
                        this.clearSession();
                        return false;
                    }

                    // Restore session
                    this.currentSession = {
                        token: sessionData.token,
                        userData: this.getUserDisplayData(user),
                        code: sessionData.code,
                        createdAt: sessionData.timestamp,
                        expiresAt: sessionData.timestamp + (30 * 60 * 1000)
                    };

                    return true;
                } catch (error) {
                    this.clearSession();
                    return false;
                }
            },

            getUserDisplayData(user) {
                return {
                    fullName: user.fullName,
                    username: user.username,
                    password: user.password
                };
            },

            getCurrentUser() {
                return this.currentSession?.userData || null;
            },

            getCurrentCode() {
                return this.currentSession?.code || null;
            },

            clearSession() {
                this.currentSession = null;
                localStorage.removeItem('securePortalSession');
            },

            generateToken() {
                return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
        };

        // ==================== DOM ELEMENTS ====================
        const elements = {
            landingPage: document.getElementById('landingPage'),
            loginContainer: document.getElementById('loginContainer'),
            profileContainer: document.getElementById('profileContainer'),
            mainFooter: document.getElementById('mainFooter'),
            enterButton: document.getElementById('enterButton'),
            loginForm: document.getElementById('loginForm'),
            passwordInput: document.getElementById('password'),
            togglePassword: document.getElementById('togglePassword'),
            loginButton: document.getElementById('loginButton'),
            statusMessage: document.getElementById('statusMessage'),
            systemStatusText: document.getElementById('systemStatusText'),
            logoutButton: document.getElementById('logoutButton'),
            supportLink: document.getElementById('supportLink'),
            profileAvatar: document.getElementById('profileAvatar'),
            profileName: document.getElementById('profileName'),
            profileCode: document.getElementById('profileCode'),
            profileDetails: document.getElementById('profileDetails')
        };

        // ==================== APPLICATION STATE ====================
        let isProcessing = false;

        // ==================== INITIALIZATION ====================
        window.addEventListener('load', initializeApp);

        function initializeApp() {
            console.log('Portail Sécurisé - Initialisation');
            
            // Check for existing session
            if (SessionManager.validateSession()) {
                // User already logged in, show profile
                showProfilePage();
            } else {
                // No valid session, show landing page
                elements.landingPage.style.display = 'flex';
                elements.landingPage.classList.remove('hidden');
                updateSystemStatus(`${Object.keys(userDatabase).length} Plateformes accessibles avec`);
            }
            
            // Set up event listeners
            setupEventListeners();
        }

        function setupEventListeners() {
            // Enter button
            elements.enterButton.addEventListener('click', handleEnterButton);
            
            // Toggle password visibility
            elements.togglePassword.addEventListener('click', togglePasswordVisibility);
            
            // Login form submission
            elements.loginForm.addEventListener('submit', handleLoginSubmit);
            
            // Logout button
            elements.logoutButton.addEventListener('click', handleLogout);
            
            // Support link
            elements.supportLink.addEventListener('click', handleSupportLink);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Input interactions
            elements.passwordInput.addEventListener('input', clearInputError);
        }

        // ==================== EVENT HANDLERS ====================
        function handleEnterButton() {
            elements.landingPage.classList.add('hidden');
            
            setTimeout(() => {
                elements.landingPage.style.display = 'none';
                elements.loginContainer.style.display = 'block';
                elements.mainFooter.style.display = 'block';
                
                setTimeout(() => {
                    elements.loginContainer.classList.add('visible');
                    elements.mainFooter.classList.add('visible');
                    elements.passwordInput.focus();
                    resetLoginState(); // Reset login state
                }, 50);
            }, 400);
        }

        function togglePasswordVisibility() {
            const type = elements.passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            elements.passwordInput.setAttribute('type', type);
            
            const icon = elements.togglePassword.querySelector('i');
            icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
            
            elements.togglePassword.setAttribute('aria-label', 
                type === 'password' ? 'Afficher le mot de passe' : 'Masquer le mot de passe'
            );
            
            elements.passwordInput.focus();
        }

        async function handleLoginSubmit(e) {
            e.preventDefault();
            
            if (isProcessing) return;
            
            const code = elements.passwordInput.value.trim();
            
            if (!code) {
                showStatus('Veuillez saisir un code d\'accès', 'error');
                return;
            }
            
            await authenticateUser(code);
        }

        function handleLogout() {
            // Clear session first
            SessionManager.clearSession();
            
            // Hide profile with animation
            elements.profileContainer.classList.remove('visible');
            
            setTimeout(() => {
                // Hide profile container
                elements.profileContainer.style.display = 'none';
                
                // Show login container
                elements.loginContainer.style.display = 'block';
                
                setTimeout(() => {
                    // Reset login form completely
                    resetLoginForm();
                    
                    // Show login container with animation
                    elements.loginContainer.classList.add('visible');
                    elements.mainFooter.classList.add('visible');
                    
                    // Show success message
                    showStatus('Déconnexion réussie. Vous pouvez vous reconnecter.', 'success');
                    
                }, 50);
            }, 300);
        }

        function handleSupportLink(e) {
            e.preventDefault();
            showStatus('whatsapp : 47050644', 'success');
        }

        // ==================== CORE FUNCTIONS ====================
        async function authenticateUser(code) {
            setLoadingState(true);
            showStatus('Vérification du code d\'accès...', 'success');
            
            // Simulate API call delay
            await delay(800);
            
            // Check if code exists
            const user = userDatabase[code];
            
            if (!user) {
                // Code not found
                showStatus('Code d\'accès invalide', 'error');
                setLoadingState(false);
                elements.passwordInput.focus();
                return;
            }
            
            if (!user.isActive) {
                // Account inactive
                showStatus('Ce compte a été désactivé', 'error');
                setLoadingState(false);
                resetLoginForm();
                return;
            }
            
            // Check code expiry
            if (user.codeExpiry) {
                const expiryDate = new Date(user.codeExpiry);
                if (expiryDate < new Date()) {
                    showStatus('Ce code d\'accès a expiré', 'error');
                    setLoadingState(false);
                    resetLoginForm();
                    return;
                }
            }
            
            // Success - create session
            const userData = SessionManager.getUserDisplayData(user);
            SessionManager.createSession(userData, code);
            
            showStatus('Accès autorisé. Chargement du profil...', 'success');
            
            // Delay for UX
            await delay(600);
            
            // Hide login, show profile
            elements.loginContainer.classList.remove('visible');
            setTimeout(() => {
                elements.loginContainer.style.display = 'none';
                showProfilePage();
            }, 300);
        }

        function showProfilePage() {
            const userData = SessionManager.getCurrentUser();
            const userCode = SessionManager.getCurrentCode();
            
            if (!userData || !userCode) {
                // Session invalid, return to login
                showLoginPage();
                showStatus('Session invalide. Veuillez vous reconnecter.', 'error');
                return;
            }
            
            // Update profile display
            updateProfileDisplay(userData, userCode);
            
            // Show profile container
            elements.profileContainer.style.display = 'block';
            elements.mainFooter.style.display = 'block';
            
            setTimeout(() => {
                elements.profileContainer.classList.add('visible');
                elements.mainFooter.classList.add('visible');
            }, 50);
            
            updateSystemStatus(`Connecté en tant que ${userData.fullName}`);
        }

        function updateProfileDisplay(userData, userCode) {
            // Set avatar from initials
            const initials = userData.fullName
                .split(' ')
                .map(name => name[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
            
            elements.profileAvatar.textContent = initials;
            elements.profileName.textContent = userData.fullName;
            elements.profileCode.textContent = `Code: ${userCode}`;
            
            // Generate and display profile fields
            elements.profileDetails.innerHTML = generateProfileFields(userData);
            
            // Add copy functionality
            setupCopyButtons();
        }

        function generateProfileFields(userData) {
            return `
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-user"></i>
                        <span>Nom Complet</span>
                    </div>
                    <div class="detail-value">${userData.fullName}</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-at"></i>
                        <span>Nom d'Utilisateur</span>
                    </div>
                    <div class="detail-value">${userData.username}</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-key"></i>
                        <span>Mot de Passe</span>
                    </div>
                    <div class="detail-value">
                        <div class="password-display">
                            <span class="actual-password" id="actualPassword">${userData.password}</span>
                            <button class="copy-button" data-text="${userData.password}" id="copyPasswordButton">
                                <i class="fas fa-copy"></i>
                                <span>Copier</span>
                            </button>
                        </div>
                        <div class="password-note">
                            Ce mot de passe est associé à votre compte
                        </div>
                    </div>
                </div>
            `;
        }

        function setupCopyButtons() {
            const copyButton = document.getElementById('copyPasswordButton');
            if (copyButton) {
                copyButton.addEventListener('click', async () => {
                    const textToCopy = copyButton.getAttribute('data-text');
                    
                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        
                        // Visual feedback
                        const originalText = copyButton.innerHTML;
                        copyButton.innerHTML = '<i class="fas fa-check"></i><span>Copié!</span>';
                        copyButton.classList.add('copied');
                        
                        showStatus('Mot de passe copié dans le presse-papier', 'success');
                        
                        // Reset button after 2 seconds
                        setTimeout(() => {
                            copyButton.innerHTML = originalText;
                            copyButton.classList.remove('copied');
                        }, 2000);
                        
                    } catch (err) {
                        showStatus('Erreur lors de la copie', 'error');
                    }
                });
            }
        }

        function showLoginPage() {
            elements.profileContainer.classList.remove('visible');
            
            setTimeout(() => {
                elements.profileContainer.style.display = 'none';
                elements.loginContainer.style.display = 'block';
                
                setTimeout(() => {
                    resetLoginForm();
                    elements.loginContainer.classList.add('visible');
                    elements.passwordInput.focus();
                }, 50);
            }, 300);
            
            updateSystemStatus(`${Object.keys(userDatabase).length} codes disponibles`);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function setLoadingState(isLoading) {
            isProcessing = isLoading;
            
            if (isLoading) {
                elements.loginButton.classList.add('loading');
                elements.loginButton.disabled = true;
                elements.passwordInput.disabled = true;
            } else {
                elements.loginButton.classList.remove('loading');
                elements.loginButton.disabled = false;
                elements.passwordInput.disabled = false;
            }
        }

        function resetLoginState() {
            isProcessing = false;
            setLoadingState(false);
            elements.passwordInput.disabled = false;
            elements.loginButton.disabled = false;
            elements.loginButton.classList.remove('loading');
        }

        function resetLoginForm() {
            elements.passwordInput.value = '';
            elements.passwordInput.focus();
            resetLoginState();
            elements.statusMessage.classList.remove('visible');
        }

        function showStatus(message, type) {
            elements.statusMessage.textContent = message;
            elements.statusMessage.className = `status-message ${type} visible`;
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    elements.statusMessage.classList.remove('visible');
                }, 3000);
            }
        }

        function updateSystemStatus(status) {
            if (elements.systemStatusText) {
                elements.systemStatusText.textContent = status;
            }
        }

        function clearInputError() {
            elements.passwordInput.classList.remove('error');
            if (elements.statusMessage.classList.contains('error')) {
                elements.statusMessage.classList.remove('visible');
            }
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        function handleKeyboardShortcuts(e) {
            // Ctrl/Cmd + Enter to submit
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (document.activeElement === elements.passwordInput) {
                    e.preventDefault();
                    elements.loginForm.requestSubmit();
                }
            }
            
            // Escape to clear
            if (e.key === 'Escape') {
                if (document.activeElement === elements.passwordInput) {
                    elements.passwordInput.value = '';
                    elements.statusMessage.classList.remove('visible');
                }
            }
            
            // F1 for system info
            if (e.key === 'F1') {
                e.preventDefault();
                const activeUsers = Object.values(userDatabase).filter(u => u.isActive).length;
                showStatus(`Système: ${Object.keys(userDatabase).length} comptes, ${activeUsers} actifs`, 'success');
            }
        }

        // ==================== INITIAL SYSTEM STATUS ====================
        const activeUsers = Object.values(userDatabase).filter(u => u.isActive).length;
        updateSystemStatus(`${activeUsers}/${Object.keys(userDatabase).length} comptes actifs`);
    </script>

     <script src="./assets/js/Configurationsmartebook.js"></script>
</body>
</html>
