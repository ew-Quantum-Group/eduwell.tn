<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portail d'Accès | Entrée Sécurisée</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ========== CSS RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        :root {
            --white: #ffffff;
            --black: #000000;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-300: #d4d4d4;
            --gray-400: #a3a3a3;
            --gray-500: #737373;
            --gray-600: #525252;
            --gray-700: #404040;
            --gray-800: #262626;
            --gray-900: #171717;
            --accent: #007AFF;
            --accent-light: rgba(0, 122, 255, 0.1);
            --success: #34C759;
            --error: #FF3B30;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.2s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* ========== LANDING PAGE ========== */
        #landingPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }

        #landingPage.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .landing-container {
            text-align: center;
            padding: 48px;
            max-width: 480px;
        }

        .landing-logo {
            width: 96px;
            height: 96px;
            background: var(--gray-50);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 36px;
            border: 1px solid var(--gray-200);
            animation: subtleFloat 8s ease-in-out infinite;
        }

        .landing-logo i {
            font-size: 40px;
            color: var(--gray-700);
        }

        .landing-title {
            font-size: 40px;
            font-weight: 600;
            letter-spacing: -0.03em;
            margin-bottom: 16px;
            color: var(--gray-900);
            line-height: 1.1;
        }

        .landing-subtitle {
            font-size: 18px;
            color: var(--gray-600);
            font-weight: 400;
            line-height: 1.6;
            margin-bottom: 48px;
            max-width: 360px;
            margin-left: auto;
            margin-right: auto;
        }

        .enter-button {
            padding: 20px 48px;
            background: var(--gray-900);
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .enter-button:hover {
            background: var(--gray-800);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ========== LOGIN PAGE ========== */
        .container {
            width: 100%;
            max-width: 440px;
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 64px 48px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .container.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* ========== PROFILE CONTAINER ========== */
        .profile-container {
            width: 100%;
            max-width: 500px;
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            display: none;
        }

        .profile-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* ========== HEADER ========== */
        .header {
            text-align: center;
            margin-bottom: 48px;
        }

        .icon-wrapper {
            width: 72px;
            height: 72px;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 28px;
            border: 1px solid var(--gray-200);
            position: relative;
            transition: var(--transition);
        }

        .icon-wrapper i {
            font-size: 28px;
            color: var(--gray-700);
        }

        .title {
            font-size: 32px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
            color: var(--gray-900);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 17px;
            color: var(--gray-600);
            font-weight: 400;
            line-height: 1.6;
            max-width: 320px;
            margin: 0 auto;
        }

        /* ========== FORM ELEMENTS ========== */
        .form-group {
            margin-bottom: 40px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }

        .input-wrapper {
            position: relative;
        }

        .password-input {
            width: 100%;
            padding: 20px 24px;
            padding-right: 56px;
            font-size: 17px;
            font-weight: 400;
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-md);
            background: var(--white);
            color: var(--gray-900);
            transition: var(--transition);
            outline: none;
            letter-spacing: 0.5px;
        }

        .password-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .password-input.error {
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 18px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .toggle-password:hover {
            color: var(--gray-700);
            background: var(--gray-100);
        }

        .submit-button {
            width: 100%;
            padding: 20px;
            background: var(--gray-900);
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .submit-button:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .submit-button.loading {
            background: var(--gray-800);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 0.8s linear infinite;
            opacity: 0;
        }

        .submit-button.loading .spinner {
            opacity: 1;
        }

        /* ========== PROFILE DISPLAY ========== */
        .profile-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--gray-200);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--accent), #5856D6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            color: var(--white);
            font-size: 36px;
            font-weight: 600;
        }

        .profile-name {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-900);
            line-height: 1.2;
        }

        .profile-code {
            font-size: 14px;
            color: var(--gray-500);
            background: var(--gray-100);
            padding: 6px 16px;
            border-radius: 20px;
            display: inline-block;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            letter-spacing: 1px;
        }

        .profile-details {
            display: grid;
            gap: 20px;
            margin-bottom: 40px;
        }

        .detail-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 24px;
            transition: var(--transition);
        }

        .detail-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .detail-label {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 12px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-label i {
            font-size: 14px;
            width: 20px;
            text-align: center;
        }

        .detail-value {
            font-size: 17px;
            color: var(--gray-900);
            font-weight: 500;
            word-break: break-word;
            line-height: 1.4;
        }

        .password-display {
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .actual-password {
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            color: var(--gray-700);
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 1px;
        }

        .copy-button {
            background: var(--gray-200);
            border: none;
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            font-size: 13px;
            color: var(--gray-700);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-button:hover {
            background: var(--gray-300);
        }

        .copy-button.copied {
            background: var(--success);
            color: white;
        }

        .password-note {
            font-size: 12px;
            color: var(--gray-400);
            margin-top: 8px;
            font-style: italic;
            line-height: 1.4;
        }

        .profile-footer {
            text-align: center;
            padding-top: 32px;
            border-top: 1px solid var(--gray-200);
        }

        .logout-button {
            background: var(--gray-900);
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .logout-button:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* ========== STATUS MESSAGES ========== */
        .status-container {
            min-height: 60px;
            margin-bottom: 32px;
        }

        .status-message {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
            animation: fadeIn 0.3s ease;
            border-left: 4px solid transparent;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
        }

        .status-message.visible {
            display: block;
        }

        .status-message.success {
            border-left-color: var(--success);
            background: rgba(52, 199, 89, 0.05);
        }

        .status-message.error {
            border-left-color: var(--error);
            background: rgba(255, 59, 48, 0.05);
        }

        .system-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--gray-50);
            border-radius: 20px;
            border: 1px solid var(--gray-200);
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* ========== FOOTER ========== */
        .footer {
            margin-top: 48px;
            text-align: center;
            display: none;
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .footer.visible {
            display: block;
            opacity: 1;
        }

        .support-link {
            color: var(--gray-600);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--gray-200);
            background: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .support-link:hover {
            color: var(--gray-900);
            background: var(--gray-50);
            border-color: var(--gray-300);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .copyright {
            font-size: 13px;
            color: var(--gray-400);
            margin-top: 20px;
            letter-spacing: 0.01em;
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes subtleFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(1deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 480px) {
            .landing-container,
            .container,
            .profile-container {
                padding: 32px 24px;
                max-width: 100%;
            }

            .landing-title,
            .title {
                font-size: 32px;
            }

            .landing-subtitle,
            .subtitle {
                font-size: 16px;
            }

            .landing-logo {
                width: 80px;
                height: 80px;
                margin-bottom: 32px;
            }

            .landing-logo i {
                font-size: 32px;
            }

            .enter-button {
                padding: 18px 40px;
                font-size: 17px;
            }

            .profile-avatar {
                width: 80px;
                height: 80px;
                font-size: 28px;
            }

            .profile-name {
                font-size: 24px;
            }

            .detail-card {
                padding: 20px;
            }
        }

        @media (max-width: 360px) {
            .container {
                padding: 40px 24px;
            }

            .title {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage">
        <div class="landing-container">
            <div class="landing-logo">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="landing-title">Accès Sécurisé</h1>
            <p class="landing-subtitle">Système d'authentification protégé pour un accès contrôlé aux ressources</p>
            <button class="enter-button" id="enterButton">
                <span>Accéder au Portail</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Login Container -->
    <div class="container" id="loginContainer">
        <header class="header">
            <div class="icon-wrapper">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="title">Portail d'Accès</h1>
            <p class="subtitle">Entrez votre code d'accès pour continuer</p>
        </header>

        <main>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password" class="form-label">CODE D'ACCÈS</label>
                    <div class="input-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            class="password-input" 
                            placeholder="Saisir le code d'accès" 
                            autocomplete="off"
                            required
                            maxlength="20"
                        >
                        <button type="button" class="toggle-password" id="togglePassword" aria-label="Afficher le mot de passe">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="submit-button" id="loginButton">
                    <span class="button-text">Continuer</span>
                    <div class="spinner"></div>
                </button>

                <div class="status-container">
                    <div class="status-message" id="statusMessage" role="alert" aria-live="polite"></div>
                </div>

                <div class="system-status">
                    <span class="status-indicator"></span>
                    <span id="systemStatusText">Système Prêt</span>
                </div>
            </form>
        </main>
    </div>

    <!-- Profile Container -->
    <div class="profile-container" id="profileContainer">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar"></div>
            <h2 class="profile-name" id="profileName"></h2>
            <span class="profile-code" id="profileCode"></span>
        </div>

        <div class="profile-details" id="profileDetails">
            <!-- Profile fields will be dynamically inserted here -->
        </div>

        <div class="profile-footer">
            <button class="logout-button" id="logoutButton">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="mainFooter">
        <a href="#" class="support-link" id="supportLink" aria-label="Support">
            <i class="fas fa-headset"></i>
            <span>Support</span>
        </a>
        <p class="copyright">© 2024 Portail d'Accès Sécurisé</p>
    </footer>

    <script>
        // ==================== USER DATABASE ====================
        const userDatabase = {
            "EMP001": {
                fullName: "Ahmed Benali",
                username: "abenali",
                password: "P@ssw0rd123",
                isActive: true,
                codeExpiry: null
            },
            "EMP002": {
                fullName: "Sophie Martin",
                username: "smartin",
                password: "Secure!2024",
                isActive: true,
                codeExpiry: null
            },
            "EMP003": {
                fullName: "Thomas Dubois",
                username: "tdubois",
                password: "Dubois789!",
                isActive: false,
                codeExpiry: "2023-12-31"
            },
            "ADMIN001": {
                fullName: "Administrateur Système",
                username: "admin",
                password: "AdminMaster#1",
                isActive: true,
                codeExpiry: null,
                isAdmin: true
            }
        };

        // ==================== SESSION MANAGEMENT ====================
        const SessionManager = {
            currentSession: null,
            
            createSession(userData, code) {
                const token = this.generateToken();
                
                this.currentSession = {
                    token,
                    userData: { ...userData },
                    code,
                    createdAt: Date.now(),
                    expiresAt: Date.now() + (30 * 60 * 1000)
                };

                localStorage.setItem('securePortalSession', JSON.stringify({
                    token,
                    code,
                    timestamp: Date.now()
                }));

                return token;
            },

            validateSession() {
                // Check memory session first
                if (this.currentSession) {
                    if (Date.now() > this.currentSession.expiresAt) {
                        this.clearSession();
                        return false;
                    }
                    return true;
                }

                // Try to restore from localStorage
                try {
                    const stored = localStorage.getItem('securePortalSession');
                    if (!stored) return false;

                    const sessionData = JSON.parse(stored);
                    
                    // Check session timeout
                    if (Date.now() - sessionData.timestamp > 30 * 60 * 1000) {
                        this.clearSession();
                        return false;
                    }

                    // Check if user still exists and is active
                    const user = userDatabase[sessionData.code];
                    if (!user || !user.isActive) {
                        this.clearSession();
                        return false;
                    }

                    // Restore session
                    this.currentSession = {
                        token: sessionData.token,
                        userData: this.getUserDisplayData(user),
                        code: sessionData.code,
                        createdAt: sessionData.timestamp,
                        expiresAt: sessionData.timestamp + (30 * 60 * 1000)
                    };

                    return true;
                } catch (error) {
                    this.clearSession();
                    return false;
                }
            },

            getUserDisplayData(user) {
                return {
                    fullName: user.fullName,
                    username: user.username,
                    password: user.password
                };
            },

            getCurrentUser() {
                return this.currentSession?.userData || null;
            },

            getCurrentCode() {
                return this.currentSession?.code || null;
            },

            clearSession() {
                this.currentSession = null;
                localStorage.removeItem('securePortalSession');
            },

            generateToken() {
                return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
        };

        // ==================== DOM ELEMENTS ====================
        const elements = {
            landingPage: document.getElementById('landingPage'),
            loginContainer: document.getElementById('loginContainer'),
            profileContainer: document.getElementById('profileContainer'),
            mainFooter: document.getElementById('mainFooter'),
            enterButton: document.getElementById('enterButton'),
            loginForm: document.getElementById('loginForm'),
            passwordInput: document.getElementById('password'),
            togglePassword: document.getElementById('togglePassword'),
            loginButton: document.getElementById('loginButton'),
            statusMessage: document.getElementById('statusMessage'),
            systemStatusText: document.getElementById('systemStatusText'),
            logoutButton: document.getElementById('logoutButton'),
            supportLink: document.getElementById('supportLink'),
            profileAvatar: document.getElementById('profileAvatar'),
            profileName: document.getElementById('profileName'),
            profileCode: document.getElementById('profileCode'),
            profileDetails: document.getElementById('profileDetails')
        };

        // ==================== APPLICATION STATE ====================
        let isProcessing = false;

        // ==================== INITIALIZATION ====================
        window.addEventListener('load', initializeApp);

        function initializeApp() {
            console.log('Portail Sécurisé - Initialisation');
            
            // Check for existing session
            if (SessionManager.validateSession()) {
                // User already logged in, show profile
                showProfilePage();
            } else {
                // No valid session, show landing page
                elements.landingPage.style.display = 'flex';
                elements.landingPage.classList.remove('hidden');
                updateSystemStatus(`${Object.keys(userDatabase).length} codes disponibles`);
            }
            
            // Set up event listeners
            setupEventListeners();
        }

        function setupEventListeners() {
            // Enter button
            elements.enterButton.addEventListener('click', handleEnterButton);
            
            // Toggle password visibility
            elements.togglePassword.addEventListener('click', togglePasswordVisibility);
            
            // Login form submission
            elements.loginForm.addEventListener('submit', handleLoginSubmit);
            
            // Logout button
            elements.logoutButton.addEventListener('click', handleLogout);
            
            // Support link
            elements.supportLink.addEventListener('click', handleSupportLink);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Input interactions
            elements.passwordInput.addEventListener('input', clearInputError);
        }

        // ==================== EVENT HANDLERS ====================
        function handleEnterButton() {
            elements.landingPage.classList.add('hidden');
            
            setTimeout(() => {
                elements.landingPage.style.display = 'none';
                elements.loginContainer.style.display = 'block';
                elements.mainFooter.style.display = 'block';
                
                setTimeout(() => {
                    elements.loginContainer.classList.add('visible');
                    elements.mainFooter.classList.add('visible');
                    elements.passwordInput.focus();
                    resetLoginState(); // Reset login state
                }, 50);
            }, 400);
        }

        function togglePasswordVisibility() {
            const type = elements.passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            elements.passwordInput.setAttribute('type', type);
            
            const icon = elements.togglePassword.querySelector('i');
            icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
            
            elements.togglePassword.setAttribute('aria-label', 
                type === 'password' ? 'Afficher le mot de passe' : 'Masquer le mot de passe'
            );
            
            elements.passwordInput.focus();
        }

        async function handleLoginSubmit(e) {
            e.preventDefault();
            
            if (isProcessing) return;
            
            const code = elements.passwordInput.value.trim();
            
            if (!code) {
                showStatus('Veuillez saisir un code d\'accès', 'error');
                return;
            }
            
            await authenticateUser(code);
        }

        function handleLogout() {
            // Clear session first
            SessionManager.clearSession();
            
            // Hide profile with animation
            elements.profileContainer.classList.remove('visible');
            
            setTimeout(() => {
                // Hide profile container
                elements.profileContainer.style.display = 'none';
                
                // Show login container
                elements.loginContainer.style.display = 'block';
                
                setTimeout(() => {
                    // Reset login form completely
                    resetLoginForm();
                    
                    // Show login container with animation
                    elements.loginContainer.classList.add('visible');
                    elements.mainFooter.classList.add('visible');
                    
                    // Show success message
                    showStatus('Déconnexion réussie. Vous pouvez vous reconnecter.', 'success');
                    
                }, 50);
            }, 300);
        }

        function handleSupportLink(e) {
            e.preventDefault();
            showStatus('Support : support@accesssystem.fr', 'success');
        }

        // ==================== CORE FUNCTIONS ====================
        async function authenticateUser(code) {
            setLoadingState(true);
            showStatus('Vérification du code d\'accès...', 'success');
            
            // Simulate API call delay
            await delay(800);
            
            // Check if code exists
            const user = userDatabase[code];
            
            if (!user) {
                // Code not found
                showStatus('Code d\'accès invalide', 'error');
                setLoadingState(false);
                elements.passwordInput.focus();
                return;
            }
            
            if (!user.isActive) {
                // Account inactive
                showStatus('Ce compte a été désactivé', 'error');
                setLoadingState(false);
                resetLoginForm();
                return;
            }
            
            // Check code expiry
            if (user.codeExpiry) {
                const expiryDate = new Date(user.codeExpiry);
                if (expiryDate < new Date()) {
                    showStatus('Ce code d\'accès a expiré', 'error');
                    setLoadingState(false);
                    resetLoginForm();
                    return;
                }
            }
            
            // Success - create session
            const userData = SessionManager.getUserDisplayData(user);
            SessionManager.createSession(userData, code);
            
            showStatus('Accès autorisé. Chargement du profil...', 'success');
            
            // Delay for UX
            await delay(600);
            
            // Hide login, show profile
            elements.loginContainer.classList.remove('visible');
            setTimeout(() => {
                elements.loginContainer.style.display = 'none';
                showProfilePage();
            }, 300);
        }

        function showProfilePage() {
            const userData = SessionManager.getCurrentUser();
            const userCode = SessionManager.getCurrentCode();
            
            if (!userData || !userCode) {
                // Session invalid, return to login
                showLoginPage();
                showStatus('Session invalide. Veuillez vous reconnecter.', 'error');
                return;
            }
            
            // Update profile display
            updateProfileDisplay(userData, userCode);
            
            // Show profile container
            elements.profileContainer.style.display = 'block';
            elements.mainFooter.style.display = 'block';
            
            setTimeout(() => {
                elements.profileContainer.classList.add('visible');
                elements.mainFooter.classList.add('visible');
            }, 50);
            
            updateSystemStatus(`Connecté en tant que ${userData.fullName}`);
        }

        function updateProfileDisplay(userData, userCode) {
            // Set avatar from initials
            const initials = userData.fullName
                .split(' ')
                .map(name => name[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
            
            elements.profileAvatar.textContent = initials;
            elements.profileName.textContent = userData.fullName;
            elements.profileCode.textContent = `Code: ${userCode}`;
            
            // Generate and display profile fields
            elements.profileDetails.innerHTML = generateProfileFields(userData);
            
            // Add copy functionality
            setupCopyButtons();
        }

        function generateProfileFields(userData) {
            return `
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-user"></i>
                        <span>Nom Complet</span>
                    </div>
                    <div class="detail-value">${userData.fullName}</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-at"></i>
                        <span>Nom d'Utilisateur</span>
                    </div>
                    <div class="detail-value">${userData.username}</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-key"></i>
                        <span>Mot de Passe</span>
                    </div>
                    <div class="detail-value">
                        <div class="password-display">
                            <span class="actual-password" id="actualPassword">${userData.password}</span>
                            <button class="copy-button" data-text="${userData.password}" id="copyPasswordButton">
                                <i class="fas fa-copy"></i>
                                <span>Copier</span>
                            </button>
                        </div>
                        <div class="password-note">
                            Ce mot de passe est associé à votre compte
                        </div>
                    </div>
                </div>
            `;
        }

        function setupCopyButtons() {
            const copyButton = document.getElementById('copyPasswordButton');
            if (copyButton) {
                copyButton.addEventListener('click', async () => {
                    const textToCopy = copyButton.getAttribute('data-text');
                    
                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        
                        // Visual feedback
                        const originalText = copyButton.innerHTML;
                        copyButton.innerHTML = '<i class="fas fa-check"></i><span>Copié!</span>';
                        copyButton.classList.add('copied');
                        
                        showStatus('Mot de passe copié dans le presse-papier', 'success');
                        
                        // Reset button after 2 seconds
                        setTimeout(() => {
                            copyButton.innerHTML = originalText;
                            copyButton.classList.remove('copied');
                        }, 2000);
                        
                    } catch (err) {
                        showStatus('Erreur lors de la copie', 'error');
                    }
                });
            }
        }

        function showLoginPage() {
            elements.profileContainer.classList.remove('visible');
            
            setTimeout(() => {
                elements.profileContainer.style.display = 'none';
                elements.loginContainer.style.display = 'block';
                
                setTimeout(() => {
                    resetLoginForm();
                    elements.loginContainer.classList.add('visible');
                    elements.passwordInput.focus();
                }, 50);
            }, 300);
            
            updateSystemStatus(`${Object.keys(userDatabase).length} codes disponibles`);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function setLoadingState(isLoading) {
            isProcessing = isLoading;
            
            if (isLoading) {
                elements.loginButton.classList.add('loading');
                elements.loginButton.disabled = true;
                elements.passwordInput.disabled = true;
            } else {
                elements.loginButton.classList.remove('loading');
                elements.loginButton.disabled = false;
                elements.passwordInput.disabled = false;
            }
        }

        function resetLoginState() {
            isProcessing = false;
            setLoadingState(false);
            elements.passwordInput.disabled = false;
            elements.loginButton.disabled = false;
            elements.loginButton.classList.remove('loading');
        }

        function resetLoginForm() {
            elements.passwordInput.value = '';
            elements.passwordInput.focus();
            resetLoginState();
            elements.statusMessage.classList.remove('visible');
        }

        function showStatus(message, type) {
            elements.statusMessage.textContent = message;
            elements.statusMessage.className = `status-message ${type} visible`;
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    elements.statusMessage.classList.remove('visible');
                }, 3000);
            }
        }

        function updateSystemStatus(status) {
            if (elements.systemStatusText) {
                elements.systemStatusText.textContent = status;
            }
        }

        function clearInputError() {
            elements.passwordInput.classList.remove('error');
            if (elements.statusMessage.classList.contains('error')) {
                elements.statusMessage.classList.remove('visible');
            }
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        function handleKeyboardShortcuts(e) {
            // Ctrl/Cmd + Enter to submit
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (document.activeElement === elements.passwordInput) {
                    e.preventDefault();
                    elements.loginForm.requestSubmit();
                }
            }
            
            // Escape to clear
            if (e.key === 'Escape') {
                if (document.activeElement === elements.passwordInput) {
                    elements.passwordInput.value = '';
                    elements.statusMessage.classList.remove('visible');
                }
            }
            
            // F1 for system info
            if (e.key === 'F1') {
                e.preventDefault();
                const activeUsers = Object.values(userDatabase).filter(u => u.isActive).length;
                showStatus(`Système: ${Object.keys(userDatabase).length} comptes, ${activeUsers} actifs`, 'success');
            }
        }

        // ==================== INITIAL SYSTEM STATUS ====================
        const activeUsers = Object.values(userDatabase).filter(u => u.isActive).length;
        updateSystemStatus(`${activeUsers}/${Object.keys(userDatabase).length} comptes actifs`);
    </script>
</body>
</html>